#{{ ansible_managed }}

# Example:
# spark.serializer                 org.apache.spark.serializer.KryoSerializer
# spark.driver.memory              5g
# spark.executor.extraJavaOptions  -XX:+PrintGCDetails -Dkey=value -Dnumbers="one two three"

spark.master {{ spark_master }}

#dynamic allocation
spark.dynamicAllocation.enabled {{ spark_dynamicAllocation_enabled }}
spark.dynamicAllocation.executorIdleTimeout 120s
spark.dynamicAllocation.cachedExecutorIdleTimeout 3600s
spark.dynamicAllocation.minExecutors 0
spark.dynamicAllocation.maxExecutors 5
spark.dynamicAllocation.initialExecutors 0

#shuffle behaviour
spark.shuffle.service.enabled {{ spark_shuffle_service_enabled }}
spark.shuffle.service.port 7337

#spark ui
spark.eventLog.dir {{ spark_eventLog_dir }}
spark.eventLog.enabled {{ spark_eventLog_enabled }}
spark.ui.enabled true
spark.ui.killEnabled true
spark.ui.port 4040
spark.ui.retainedJobs 1000
spark.ui.retainedStages 1000
spark.ui.retainedTasks 100000
spark.ui.reverseProxy false



spark.history.fs.logDirectory {{ spark_history_fs_logDirectory }}
spark.history.provider org.apache.spark.deploy.history.FsHistoryProvider
spark.history.ui.port {{ spark_history_ui_port }}

spark.history.yarn.diagnostics true
spark.history.kerberos.keytab none
spark.history.kerberos.principal none

spark.yarn.historyServer.address {{ spark_yarn_historyServer_address }}

#spark properties
spark.yarn.am.memory {{ spark_yarn_am_memory }}
spark.yarn.am.cores {{ spark_yarn_am_cores }}

spark.yarn.driver.memoryOverhead {{ spark_yarn_driver_memoryOverhead }}
spark.yarn.executor.memoryOverhead {{ spark_yarn_executor_memoryOverhead }}

spark.yarn.containerLauncherMaxThreads 25
spark.yarn.max.executor.failures 3
spark.yarn.preserve.staging.files false
spark.yarn.queue default
spark.yarn.scheduler.heartbeat.interval-ms 5000
spark.yarn.submit.file.replication 3

spark.hadoop.cacheConf false

#sparkR
spark.r.numRBackendThreads 2
spark.r.command Rscript
spark.r.driver.command Rscript
spark.r.shell.command R
spark.r.backendConnectionTimeout 6000
spark.r.heartBeatInterval 100
